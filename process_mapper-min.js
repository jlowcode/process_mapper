define(["jquery","fab/list-plugin"],function(e,t){var n=new Class({Extends:t,initialize:function(e){this.parent(e)},buttonAction:function(){var t=[];this.listform.getElements("input[name^=ids]").each(function(e){!1!==e.get("value")&&!1!==e.checked&&t.push(e.get("value"))}),1===t.length&&(e("#processMapperModal").length&&e("#processMapperModal").remove(),this.setProcessElements(t[0]))},createModal:function(){var e=document.createElement("div");e.setAttribute("class","process_mapper-modal"),e.setAttribute("id","processMapperModal");var t=document.createElement("div");t.setAttribute("class","process_mapper-modal-content");var n=document.createElement("div");n.setAttribute("class","process_mapper-modal-header");var o=document.createElement("span");o.setAttribute("class","process_mapper-modal-close"),o.innerHTML="&times;";var a=document.createElement("h4");a.innerHTML="Mapeamento",n.appendChild(o),n.appendChild(a);var i=document.createElement("div");i.setAttribute("class","process_mapper-modal-body");var s=document.createElement("div");s.setAttribute("id","div_table_mapper"),s.setAttribute("class","table-responsive"),s.setAttribute("style","overflow: auto"),i.appendChild(s);var r=document.createElement("div");r.setAttribute("class","process_mapper-modal-footer");var p=document.createElement("button");p.setAttribute("class","btn btn-default"),p.setAttribute("id","validateButton"),p.setAttribute("style","margin: 5px"),p.innerHTML="Validar";var l=document.createElement("button");l.setAttribute("class","btn btn-default"),l.setAttribute("id","mapearTudo"),l.setAttribute("style","margin: 5px"),l.innerHTML="Mapear Tudo",r.appendChild(p),r.appendChild(l),t.appendChild(n),t.appendChild(i),t.appendChild(r),e.appendChild(t);var d=document.getElement("body"),m=document.getElement("head"),c=document.createElement("link");c.setAttribute("href",this.options.url+"plugins/fabrik_list/process_mapper/modal/modal.css"),c.setAttribute("rel","stylesheet"),d.appendChild(e),m.appendChild(c)},openModal:function(){var e=document.getElementById("processMapperModal"),t=document.getElement("body");t.style.overflowY="hidden",e.style.display="block";var n=document.getElementsByClassName("process_mapper-modal-close")[0];n.onclick=function(){e.style.display="none",t.style.overflowY="auto"},window.onclick=function(n){n.target==e&&(e.style.display="none",t.style.overflowY="auto")}},setProcessElements:function(t){var n=this;n.options.processId=t,e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"elementsToMapper",g:"list",processId:t,table:n.options.table,elementBpmn:n.options.elementBpmn,infos:n.options.infos}}).done(function(e){n.options.processElements=JSON.parse(e),n.createModal(),n.createTable(),n.validateButton(),n.mapearTudo(),n.openModal()})},createTable:function(){var t=document.getElementById("div_table_mapper"),n=document.createElement("table");n.setAttribute("class","table"),n.setAttribute("id","table_mapper");var o=document.createElement("thead"),a=document.createElement("tr"),i=document.createElement("th");i.setAttribute("scope","col"),i.innerHTML="Elemento do Diagrama";var s=document.createElement("th");s.setAttribute("scope","col"),s.innerHTML="Tipo";var r=document.createElement("th");r.setAttribute("scope","col"),r.innerHTML="Estado";var p=document.createElement("th");p.setAttribute("scope","col"),p.innerHTML="Observações",a.appendChild(i),a.appendChild(s),a.appendChild(r),a.appendChild(p),o.appendChild(a),n.appendChild(o);var l,d,m,c,u,h,b,f=document.createElement("tbody"),v=this.options.processElements,g=this;for(l=0;l<v.length;l++)""!=v[l].titulo&&(d=document.createElement("tr"),v[l].mapped&&0!=v[l].updated||(d.style.color="#bd362f"),m=document.createElement("td"),m.innerHTML=v[l].titulo,c=document.createElement("td"),c.innerHTML=v[l].tipo,u=document.createElement("td"),b=document.createElement("a"),v[l].delete_el?(b.setAttribute("href","#"),b.setAttribute("id",l),b.innerHTML="Excluir",b.onclick=function(){e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"deleteElement",g:"list",elementRow:g.options.processElements[this.getAttribute("id")],infos:g.options.infos}}).done(e=>{var t=this.getParent(),n=t.getParent();n.remove()})}):0==v[l].updated?(b.setAttribute("href","#"),b.setAttribute("id",l),b.innerHTML="Atualizar",b.onclick=function(){e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"updateProcessStatus",g:"list",elementRow:g.options.processElements[this.getAttribute("id")],infos:g.options.infos}}).done(e=>{this.setAttribute("href","#"),this.setAttribute("formvalue",g.options.infos.form_id),this.innerHTML="Atualizado",g.options.processElements[this.getAttribute("id")].mapped=!0,g.options.processElements[this.getAttribute("id")].notes=""})}):v[l].mapped?(b.setAttribute("href","javascript:window.open('"+Fabrik.liveSite+"index.php?option=com_fabrik&view=form&formid="+this.options.infos.form_id+"&rowid="+v[l].id+"','_blank')"),b.setAttribute("target",""),b.setAttribute("formvalue",this.options.infos.form_id),b.innerHTML="Mapeado"):"textAnnotation"==v[l].tipo||"association"==v[l].tipo||"laneSet"==v[l].tipo?b.innerHTML="Ignorar":(b.setAttribute("href","#"),b.setAttribute("id",l),b.innerHTML="Mapear",b.onclick=function(){e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"createElement",g:"list",elementRow:g.options.processElements[this.getAttribute("id")],infos:g.options.infos}}).done(e=>{this.innerHTML="Mapeado",g.options.processElements[this.getAttribute("id")].mapped=!0})}),u.appendChild(b),h=document.createElement("td"),h.innerHTML=v[l].notes,d.appendChild(m),d.appendChild(c),d.appendChild(u),d.appendChild(h),f.appendChild(d));n.appendChild(f),t.appendChild(n)},validateButton:function(){var t=document.getElementById("validateButton"),n=this;t.onclick=function(){if(n.options.processElements.length>0){var t,o=n.options.processElements,a=!0,i=!1;for(t=0;t<o.length;t++)!1===o[t].mapped&&(a=!1),"userTask"===o[t].tipo&&(i=!0);a?i?e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"updateProcessStatus",g:"list",processId:n.options.processId,table:n.options.table,elementStatus:n.options.elementStatus,statusValue:n.options.statusValue}}).done(function(e){alert("Status do processo atualizado!")}):alert("Necessário pelo menos uma tarefa de usuário!"):alert("Faltam elementos para mapear!")}else alert("Não existem elementos no diagrama BPMN!!")}},mapearTudo:function(){var e=this.options.processElements,t=document.getElementById("mapearTudo");t.onclick=function(){var t,n;for(t=0;t<e.length;t++)n=document.getElementById(t),n&&"Mapear"===n.innerHTML&&n.click()}}});return n});