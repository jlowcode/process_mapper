define(["jquery","fab/list-plugin"],function(e,t){var n=new Class({Extends:t,initialize:function(e){this.parent(e)},buttonAction:function(){var t=[];this.listform.getElements("input[name^=ids]").each(function(e){!1!==e.get("value")&&!1!==e.checked&&t.push(e.get("value"))}),1===t.length&&(e("#processMapperModal").length&&e("#processMapperModal").remove(),this.setProcessElements(t[0]))},createModal:function(){var e=document.createElement("div");e.setAttribute("class","process_mapper-modal"),e.setAttribute("id","processMapperModal");var t=document.createElement("div");t.setAttribute("class","process_mapper-modal-content");var n=document.createElement("div");n.setAttribute("class","process_mapper-modal-header");var o=document.createElement("span");o.setAttribute("class","process_mapper-modal-close"),o.innerHTML="&times;";var a=document.createElement("h2");a.innerHTML="Mapeamento",n.appendChild(o),n.appendChild(a);var i=document.createElement("div");i.setAttribute("class","process_mapper-modal-body");var r=document.createElement("div");r.setAttribute("id","div_table_mapper"),r.setAttribute("class","table-responsive"),r.setAttribute("style","overflow: auto"),i.appendChild(r);var s=document.createElement("div");s.setAttribute("class","process_mapper-modal-footer");var l=document.createElement("button");l.setAttribute("class","btn btn-default"),l.setAttribute("id","validateButton"),l.setAttribute("style","margin: 10px"),l.innerHTML="Validar";var p=document.createElement("button");p.setAttribute("class","btn btn-default"),p.setAttribute("id","mapearTudo"),p.setAttribute("style",""),p.innerHTML="Mapear Tudo",s.appendChild(l),s.appendChild(p),t.appendChild(n),t.appendChild(i),t.appendChild(s),e.appendChild(t);var d=document.getElement("body"),c=document.getElement("head"),m=document.createElement("link");m.setAttribute("href",this.options.url+"plugins/fabrik_list/process_mapper/modal/modal.css"),m.setAttribute("rel","stylesheet"),d.appendChild(e),c.appendChild(m)},openModal:function(){var e=document.getElementById("processMapperModal"),t=document.getElement("body");t.style.overflowY="hidden",e.style.display="block";var n=document.getElementsByClassName("process_mapper-modal-close")[0];n.onclick=function(){e.style.display="none",t.style.overflowY="auto"},window.onclick=function(n){n.target==e&&(e.style.display="none",t.style.overflowY="auto")}},setProcessElements:function(t){var n=this;n.options.processId=t,e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"elementsToMapper",g:"list",processId:t,table:n.options.table,elementBpmn:n.options.elementBpmn,infos:n.options.infos}}).done(function(e){n.options.processElements=JSON.parse(e),n.createModal(),n.createTable(),n.validateButton(),n.mapearTudo(),n.openModal()})},createTable:function(){var t=document.getElementById("div_table_mapper"),n=document.createElement("table");n.setAttribute("class","table"),n.setAttribute("id","table_mapper");var o=document.createElement("thead"),a=document.createElement("tr"),i=document.createElement("th");i.setAttribute("scope","col"),i.innerHTML="Elemento do Diagrama";var r=document.createElement("th");r.setAttribute("scope","col"),r.innerHTML="Tipo";var s=document.createElement("th");s.setAttribute("scope","col"),s.innerHTML="Estado";var l=document.createElement("th");l.setAttribute("scope","col"),l.innerHTML="Observações",a.appendChild(i),a.appendChild(r),a.appendChild(s),a.appendChild(l),o.appendChild(a),n.appendChild(o);var p,d,c,m,u,h,b,f=document.createElement("tbody"),v=this.options.processElements,E=this;for(p=0;p<v.length;p++)d=document.createElement("tr"),c=document.createElement("td"),c.innerHTML=v[p].titulo,m=document.createElement("td"),m.innerHTML=v[p].tipo,u=document.createElement("td"),b=document.createElement("a"),v[p].delete_el?(b.setAttribute("href","#"),b.setAttribute("id",p),b.innerHTML="Excluir",b.onclick=function(){e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"deleteElement",g:"list",elementRow:E.options.processElements[this.getAttribute("id")],infos:E.options.infos}}).done(e=>{var t=this.getParent(),n=t.getParent();n.remove()})}):v[p].mapped?(b.setAttribute("href","javascript:window.open('"+Fabrik.liveSite+"index.php?option=com_fabrik&view=form&formid="+this.options.infos.form_id+"&rowid="+v[p].id+"','_blank')"),b.setAttribute("target",""),b.setAttribute("formvalue",this.options.infos.form_id),b.innerHTML="Mapeado"):(b.setAttribute("href","#"),b.setAttribute("id",p),b.innerHTML="Mapear",b.onclick=function(){e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"createElement",g:"list",elementRow:E.options.processElements[this.getAttribute("id")],infos:E.options.infos}}).done(e=>{this.setAttribute("href","javascript:window.open('"+Fabrik.liveSite+"index.php?option=com_fabrik&view=form&formid="+E.options.infos.form_id+"&rowid="+e+"','_blank')"),this.setAttribute("target",""),this.setAttribute("formvalue",E.options.infos.form_id),this.innerHTML="Atualizar",this.onclick=function(){},E.options.processElements[this.getAttribute("id")].mapped=!0})}),u.appendChild(b),h=document.createElement("td"),h.innerHTML=v[p].notes,d.appendChild(c),d.appendChild(m),d.appendChild(u),d.appendChild(h),f.appendChild(d);n.appendChild(f),t.appendChild(n)},validateButton:function(){var t=document.getElementById("validateButton"),n=this;t.onclick=function(){if(n.options.processElements.length>0){var t,o=n.options.processElements,a=!0,i=!1;for(t=0;t<o.length;t++)!1===o[t].mapped&&(a=!1),"userTask"===o[t].tipo&&(i=!0);a?i?e.ajax({url:Fabrik.liveSite+"index.php",method:"POST",data:{option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"process_mapper",method:"updateProcessStatus",g:"list",processId:n.options.processId,table:n.options.table,elementStatus:n.options.elementStatus,statusValue:n.options.statusValue}}).done(function(e){alert("Status do processo atualizado!")}):alert("Necessário pelo menos uma tarefa de usuário!"):alert("Faltam elementos para mapear!")}else alert("Não existem elementos no diagrama BPMN!!")}},mapearTudo:function(){var e=this.options.processElements,t=document.getElementById("mapearTudo");t.onclick=function(){var t,n;for(t=0;t<e.length;t++)n=document.getElementById(t),n&&"Mapear"===n.innerHTML&&n.click()}}});return n});